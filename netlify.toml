
[functions]
external_node_modules = ["sharp"]
included_files = ["node_modules/sharp/**/*", "./github.pem"]

[[plugins]]
    package = "@netlify/plugin-nextjs"

# Attach edge function to all legacy routes
[[edge_functions]]
  path = "/tutorial/*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/:locale/tutorial/*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/tracks/*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/:locale/tracks/*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/faq/*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/announcements/*"
  function = "redirect-from-old-portal"

# For announcements and faq, we need to match the --key as well if the path contains the locale. This is needed to prevent a redirect loop. This happens because the new portal path pattern also includes "/:locale/faq|announcements".
[[edge_functions]]
  path = "/:locale/faq/*--*"
  function = "redirect-from-old-portal"

[[edge_functions]]
  path = "/:locale/announcements/*--*"
  function = "redirect-from-old-portal"